# MIPS指令集

MIPS（Microprocessor without Interlocked Piped Stages），RISC指令集的代表，国内龙芯采用的架构，其专利期已过，可免费使用。

![image-20201002192314437](C:/Users/Five/Desktop/note/img/1-46.png)



## 主要特点

* 关注点
  * 减少指令的类型
  * 降低指令的复杂度
  * A simpler CPU is a faster CPU

* 固定的指令长度
  * 32bit，1word（与x86中16bit一个word不同）
  * 简化了取指操作
* 简单的寻址模式
* 指令数量少，指令功能简单
* 只有Load和Store两条指令访问存储器
  * 不同于x86指令ADD等操作可以直接访问存储器



虽然逻辑和结构简单了，但直接用基础、简单的指令进行编程，程序的体积会更大。



## MIPS指令集架构概述

> 关于MIPS32指令集的官方文档可在我博客主页的appendix目录下找到。或可官网获取。
>
> 以下内容部分取自《MIPS32™ Architecture For Programmers Volume II: The MIPS32™ Instruction Set》



### MIPS指令集

MIPS指令分为R型、I型和J型。

R型指令比I型指令常见，这就导致在设计处理器时，默认实现R型指令，只有当检测到I型指令时，才做调整。即对I型指令有偏见，优先照顾R型指令。

![image-20201002200434263](C:/Users/Five/Desktop/note/img/1-51.png)

R型指令

![image-20201002200737624](C:/Users/Five/Desktop/note/img/1-53.png)

* rs，Resource Register 通常为第一个源操作数
* rt，Target Register 通常为第二个源操作数
* rd，Destination Register 通常为目的操作数
* shamt，Shift Amount 移位指令进行移位的位数

![image-20201002201415955](C:/Users/Five/Desktop/note/img/1-54.png)



----

I型指令

![image-20201002201531173](C:/Users/Five/Desktop/note/img/1-55.png)

> x86指令可以随意使用更大宽度的立即数，指令没有限制长度。
>
> 但MIPS不行。

![image-20201002202323857](C:/Users/Five/Desktop/note/img/1-56.png)



* 条件分支指令

![image-20201002202506636](C:/Users/Five/Desktop/note/img/1-57.png)

示例：

![image-20201002202647281](C:/Users/Five/Desktop/note/img/1-58.png)

局限性

![image-20201002202853920](C:/Users/Five/Desktop/note/img/1-59.png)



----

J型命令



![image-20201002205601931](C:/Users/Five/Desktop/note/img/1-61.png)

![image-20201002204019858](C:/Users/Five/Desktop/note/img/1-60.png)



----

前文描述指令集是按R/I/J型划分，没有像x86一样通过运算、访存、分支进行划分。下图是对后一种划分的补充。

![image-20201002200501393](C:/Users/Five/Desktop/note/img/1-52.png)



### MIPS寄存器

通用寄存器

![image-20201002200103594](C:/Users/Five/Desktop/note/img/1-49.png)

![image-20201002200204936](C:/Users/Five/Desktop/note/img/1-50.png)



> 没有标志寄存器

## MIPS之死

2021年3月10日，在去食堂吃饭的路上，不幸收到了MIPS的死讯，一时间悲从中来，百感交集。

出身名门，一路走上巅峰，Intel被其势头震惊，斥巨资孵化IA-64（IA-64比MIPS还悲剧），龙芯也用MIPS，MIPS一度和x86、ARM三分天下，都以为会是麒麟子，结果命运多舛，徒呼奈何。

在PC端还是弄不过Intel、AMD，移动端ARM也一口汤没留，被迫贱卖，Imagination和ARM的Bride Crossing合购并交叉授权。

结果苹果自研GPU，Imagination抛售MIPS，自己都面临收购。

兜兜转转到了AI初创企业Wave Computing手里，该公司很多成员是MIPS的老人，后将MIPS直接开源，也总算有着落了吧，结果Wave Computing不久申请破产重组。

MIPS最终放弃此前的同名架构，投身RISC-V。

所以，事已至此，MIPS是不是该从408里踢出去了？







# POWER

Performance Optimization With Enhanced RISC。

最通用的几种CPU体系结构之一，由IBM公司设计开发。

> 和x86类似，POWER一指由IBM公司设计开发的一种基于RISC架构的指令集体系构架（[ISA](https://baike.baidu.com/item/ISA))，即POWER ISA。二指是实现了POWER ISA的处理器系列的名称。



## PowerPC

Performance Optimization With Enhanced RISC – Performance Computing

（所以这里的PC可不是Personal Computer的意思，而是Performance Computing）

是一种精简指令集架构的中央处理器

http://www.elecfans.com/emb/danpianji/20180311645814.html

为什么我喜欢 ARM 和 PowerPC？ - Linux中国的文章 - 知乎 https://zhuanlan.zhihu.com/p/36569225

# ARM

ARM在平常提及时可能指两样不同的东西：

* 英国Acorn公司设计的RISC微处理器，Acorn RISC Machine
* Acorn公司和Apple合作创立的ARM公司，Advanced RISC Machine，半导体知识产权提供商

一个是ISA，一个是公司。此处指前者。

ARM公司顶着Intel逆风飞翔也是传奇，它在世界范围有超过100个的合作伙伴。ARM 采用转让许可证制度，自己不制造芯片，只将芯片的设计方案授权给其他公司，由它们来生产。



## Cortex



## 苹果A系列

苹果的A系列好像是ARM架构，但好像又有不同。没找到太多的资料。

## 麒麟



## 骁龙



## 天玑



## 猎户座

国内三星基本凉透了，拉走吧。

# RISC-V





# 其他



SPARC

SPARC（Scalable Processor ARChitecture）架构完全开放

# 设计一个自己的指令集

Here are some examples of the simple operations that the CPU might carry out at the request of an instruction.

* Load: Copy a byte or a word from main memory into a register, overwriting the previous contents of the register.
* Store: Copy a byte or a word from register to a location in main memory, overwriting the previous contents of that location.
* Operator: Copy the contents of two registers to the ALU, perform an arithmetic operation on the two words, and store the result in a register, overwriting the previous contents of that register.
* Jump: Extract a word from the instruction itself and copy that word into the program counter (PC), overwriting the previous value of the PC.
  * 感觉就是Load into program counter register.

当然这只是最基础的指令。

`modern processors use far more complex mechanisms to speed up program execution`.[^1]

## 指令类型

* 运算类指令
  * ADD R, M：将寄存器R中内容与内存M中对应内容相加，保存到R

* 传送类指令
  * LOAD R,M：M中内容装入R
  * STORE M,R：将R中内容存入M

* 转移类指令
  * JMP L：无条件转向L处



## 指令的格式

> CPU硬件和软件沟通的桥梁

* 每条指令等长，均为2个字节
* 第一个字节的高四位是操作码 ，低四位是寄存器号
  * 如LOAD: 0000, ADD: 0001, STORE: 0010, JMP: 0011
    * CPU如何识别指令可参考之前的文章
    * 其中JMP是对寄存器PC操作的指令
    * LOAD、ADD、STORE等指令主要涉及其他的寄存器，这个过程中寄存器PC通常递增寻找下一条指令。
  * 四位寄存器号意味着最多可表示$2^4=16$个寄存器
* 第二个字节表示存储单元地址
  * 最大可以对应$2^8=256$个地址，即可以使用256字节的存储器



## 简化版MIPS指令集

尽管MIPS是RISC架构，但对于入门而言还是太多了，所以需要进行简化。

* 运算类指令
  * 加法和减法（无符号）
    * addu rd, rs, rt
    * subu rd, rs, rt
  * 逻辑或（立即数）
    * ori rt, rs, imm16
* 访问和存储指令
  * lw rt, imm16(rs)
  * sw rt, imm16(rs)
* 分支指令
  * 条件分支
    * beq rs, rt, imm16



## 指令位域

* R型指令
* I型指令

![image-20201215165240145](C:\Users\Five\Desktop\note\img\image-20201215165240145.png)

`shamt`标记移位的数量（在简化版中作为保留位域），`funct`是功能位域。



## 分析指令系统需求

![](C:\Users\Five\Desktop\note\img\image-20201215170731011.png)



![](C:\Users\Five\Desktop\note\img\image-20201215170856800.png)



* ALU
* 立即数扩展部件：零扩展、符号扩展
* 程序计数寄存器PC
  * 加4或加一个立即数
* 寄存器堆
  * 每个寄存器32位，共32个（对应指令域$2^5=32$）
  * 读操作ts和rt，写操作rt或rd
  * 两读一写的寄存器堆。
  * 寄存器堆的读操作不受时钟控制，而写操作是在时钟上升沿完成的。
* 存储器
  * 写入地址信号，输出对应地址的内容。
  * 一个只读的指令存储器，地址和数据均为32位
  * 一个可读写的数据存储器，地址和数据均为32位
  * 对应的是CPU的指令和数据高速缓存，既不是内存，也不是寄存器。







[^1]:《Computer System: A Programmer's Perspective》