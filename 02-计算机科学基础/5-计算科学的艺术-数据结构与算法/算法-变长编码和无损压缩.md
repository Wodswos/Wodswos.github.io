> 压缩是一种编码的技术。

一般文本信息通过ANSI或者Unicode（具体实践中可以是UTF8也可以是UTF16，无伤大雅）编码为二进制信息，而可执行程序本身就在某种程度上是以二进制的形式存在。

而压缩也是一次编码，不过目的不是编码到二进制（毕竟已经是二进制了），而是减小编码后的二进制所占的空间（一般是利用不同的二进制段出现的频率差异）。



描述新信息所用的熵 < 以新信息作为前提后原信息降低的熵

或者码表 + 压缩后的内信息 < 原信息

那么，就是压缩了。



> 数据压缩是一门通信原理和计算机科学都会涉及到的学科，在通信原理中，一般称为信源编码，在计算机科学里，一般称为数据压缩。
>
> 两者在本质上并无区别，从数学角度看，都是映射。[^4]



各种方法之所以（往往）能起到压缩的作用，是因为真的引入了新的信息——如不同字符（信息编码）的出现频率有很大不同，熵值降低了，自然可以用更少的比特数存储。



哈夫曼编码是不定长编码，

以ASCII码作为基本编码，







所以前面还得加一个特殊标记来区分一下，到底接下来的Unicode码是指普通字符，还是指距离和长度

> 这种特殊标记位的设计类似计算机语言的转义符`\`，在计算机语言中真的需要表示转义符时，需要通过类似`\\`的方式来表达一个反斜杠（转义符）。





如[这篇文章](https://www.cnblogs.com/esingchan/p/3958962.html)所说（文章作者可能对Unicode和UTF8/16并不是很熟悉，但不影响文章内容的优秀）

# 哈夫曼编码









# LZ77[^3]

> Ziv和Lempel于1977年发表论文《A Universal Algorithm for Sequential Data Compression》。
>
> LZ77的LZ取自Lempel和Ziv首字母，除LZ77外还有，LZ78、LZW、LZO、LZMA、LZSS、LZR等等。

同Huffman编码一样，LZ77只定义了原理，并没有定义如何实现，即不算是一种具体的算法。

LZ77会维护一个短语字典，即将长字符串（字典的value）编码成短小的标记（字典的key），用小标记代替字典中的短语，从而达到压缩的目的。

> 未经压缩的原文可以理解为维护了一个空字典，所有字符串计算和0的相对位移量——所有数到0的距离当然就是数本身。

以字符串`dwjaiosjdioajwiodjoiwnqoinoidjsioueriqojoidajsdkljqiowueiouwe`为例，前向缓冲区，滑动窗口

1. 先设定一个固定大小的搜索缓冲区，例如 16（在真实场景中，这个缓冲区的大小一般是几十 kB ）。







## 特殊到一般

虽然以字符串举例，但字符串显然仅仅是数据的一种形式而已。





LZ77是一种字典编码，倒不如说是“引用”编码更贴切。就像在Python中一切都是引用（包括自然数0、1……如果没有实例则先建立一个实例，然后所有用到0、1……的地方都是一个指向该实例的引用）。









## 压缩的极限

用LZ77算法压缩的程度取决于很多因素，例如，选择滑动窗口的大小，为前向缓冲区设置的大小，以及数据本身的熵。最终，压缩的程度取决于能匹配的短语的数量和短语的长度。大多数情况下，LZ77比霍夫曼编码有着更高的压缩比，但是其压缩过程相对较慢。

### 数据本身的熵

熵是对不确定性的度量，

那么对于一串比特而言其熵取决于……怎么分割数据？





打个比方，一个二进制文件大小为1KB，即8192个比特，取字典为{1:10000000}（缓冲区大小8），那么，最少可以，每8位比特都可以用7个比特的偏移量来代替





# zip

鼎鼎大名的压缩格式——某种程度上的行业标准。Python的wheel包和Java的Jar包也都是zip文件。、

Phil Katz，开源先驱，因为制作压缩软件PKARC（模仿且兼容商业软件ARC）被告上法庭（牵涉知识产权），在牢中面壁思考，后整除PKZIP并开源。2000年不幸英年早逝。[^4]

> 用UE打开ZIP文件，我们能看到开头的两个字节就是PK（Phil Katz）两个字符的ASCII码



# gzip[^1][^2]









[^1]:https://github.com/xitu/gold-miner/blob/master/article/2020/understand-the-deflate-compression-behind-the-zip-and-gzip-formats.md
[^2]:https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Compression
[^3]:https://www.cnblogs.com/idreamo/p/9249367.html
[^4]:https://www.cnblogs.com/esingchan/p/3958962.html