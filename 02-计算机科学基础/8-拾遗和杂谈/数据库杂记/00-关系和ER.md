# Why Rational

> 人们总是喜欢制造这些概念上的壁垒，用以防止自己的理论受到攻击。把过错推到 SQL身上，说 SQL 没有忠实的实现关系式理论的精髓，是关系式数据库领域常见的托词，用以掩盖其本质上的空洞。[^1]

# 关系型数据库

先验知识：关系和集合的数学定义（离散数学）

## 关系操作和关系代数

> 接受了“关系是集合”之后，以集合运算的视角来看关系运算，会自然很多。

选择、投影、并、差、笛卡尔积是五种基本的集合操作。

操作的对象和结果都是集合。（虽然基本单位是元组$t$）

* 并：$R \cup S=\{t|t \in R \vee t \in S\}$
* 差：$R - S =\{t | t \in R \vee t \notin S\}$
* 交：$R \cap S = \{t| t \in R \wedge t \in S\}$
* 笛卡尔积：$R\times S = \{\overline {t_rt_s}|t_r\in R \wedge t_s \in S\}$

以上是传统基础的集合运算，以下特指关系运算

* 投影
* 选择
* 连接
* 除运算

### 关系数据语言

关系完备性：关系数据语言能够表示关系代数可以表示的查询。

关系代数、元组关系演算、域关系演算三种语言在表达能力上是等价的。

![image-20201116135533694](C:\Users\Five\Desktop\note\img\image-20201116135533694.png)

SQL是集查询、数据定义语言DDL、数据操纵语言DML和数据控制语言DCL于一体的关系数据语言。

SQL是一种高度非过程化的语言，不必请求DBA为其建立特殊的存取路径，存取路径的选择由RDBMS的优化机制来完成。

## 关系完整性

关系模型的完整性规则是对关系的某种约束条件，这些约束条件实际上是现实世界的要求。任何关系在任何时候都要满足这些语义约束。

### 实体完整性

实体完整性：基本关系R的主属性不能取空值。若主码由若干属性组成，则这些属性都不能取空值。

> 现实世界中的实体都是可区分的，即他们具有某种唯一性标识。

### 参照完整性

参照关系和外码

* 基本关系$R$和其一个或一组属性$F$，基本关系$S$和其主码$K_S$
* 若$F$与$K_S$相对应，则称$F$是$R$的外码，$R$为参照关系，$S$为被参照关系。

参照完整性：若基本关系$R$的属性$F$与基本关系$S$的主码$K_S$相对应，则对于$R$中的每个$F$需满足：取空值或者等于$S$中某个元组的主码值。

### 用户定义的完整性







# 关系式模型的实质

摘自（照搬）王垠大佬文章《关系式模型的实质》http://www.yinwang.org/blog-cn/2014/04/24/relational

数据库所谓的查询（query），本质上就是函数式语言里面的 filter, map 等操作。只不过关系式代数更加笨拙，组合能力很弱。比如，以下的 SQL 语句

```
SELECT Book.title
 FROM Book
 WHERE price > 100
```

表达的东西相当于以下的 Lisp 代码：

```
(map book-title
     (filter (lambda (b) (> (book-price b) 100)) Book)
```

但 SQL 的嵌套组合能力和一致性都要比 Lisp 差很多。很多你认为应该自然可以表达的查询，SQL 表达不了，折腾很久才发现得用很蹩脚的方式表达。嵌套的查询经常是个问题，需要扩展 SQL 的语法才能实现，而 Lisp 天生可以优雅地表达任意的嵌套和组合。

不可否认，某些 SQL 底层实现对基本查询的实现或许更加高效，然而其实 Lisp 的底层运行系统也可以采用类似的高效实现。我们不应该把“底层实现”和“上层概念”混淆起来。

一个糟糕的概念可以被实现得很快，然而概念本身仍然是糟糕的，用起来痛苦，莫名其妙。一个优雅的设计也许被实现得很低效很慢，但聪明人看到了它概念上的优势，可以改变底层实现，做出很高效的系统。实际上已经有人实现了这样的数据库系统，它用类似这里的 Lisp 方式来表达查询。



所以关系式模型所能表达的东西，不会超过普通数据结构，然而关系式模型却有比数据结构更多的局限。由于“行”只能有固定的宽度，所以导致了你没法在里面放进任何“变长”的对象。比如，如果你有一个动态长度的数组，那你是不能把它放在一个行里的。你需要把数组拿出来，旋转 90 度，做成另一个表 B。从原来的表 A，用一个“foreign key”指向 B。更傻的是，在表 B 的每一行，这个 key 都要被重复一次。数组有多长，这个 key 就需要重复多少次，占用大量不必要的空间。这种从数据结构角度看来极其愚蠢的做法，在数据库领域却被起了一个高深莫测的名字，叫做“normalization”.



数据模型可以完全被普通的数据结构所表示，然而它们却不可能简单而完整的表达数据结构带有的信息。这些数据模型之所以流行，是因为它们让人误以为知道了所谓的“一对一”，“一对多”等冠冕堂皇的概念，就可以取代设计数据结构所需要的技能。所以我认为数据模型本身就属于技术上的“减肥药”，告诉你要吃好几个疗程才会见效，最后还是不见效，那肯定是你自己什么地方操作错了。

# E-R图







# Why NoSQL[^1]

> 所以到现在，我的脑子里早已不存在“数据库”，“关系式”，“NoSQL”这样的概念，因为它们带来的更多是困扰，它们把本来简单的问题复杂化。在我的脑子里，只有更通用而简单的数据结构，以及针对它们的高效存储处理方式。[^1]





[^1]:王垠大佬文章《关系式模型的实质》http://www.yinwang.org/blog-cn/2014/04/24/relational
