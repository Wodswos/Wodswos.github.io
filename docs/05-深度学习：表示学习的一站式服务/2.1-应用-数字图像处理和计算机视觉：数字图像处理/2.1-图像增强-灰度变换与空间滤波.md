

# Background

$$
g(x,y) = T[f(x,y)]
$$

其中 T 是在点 $(x,y)$ 处的一个邻域上定义的针对 $f$ 的算子，称为灰度（或灰度级或映射）变换函数。

> 简单来说，函数是数到数的映射，泛函是函数到数的映射，算子是函数到函数的映射。
>
> 可以可以把数当作常函数，那么普通的函数也可以看作泛函或算子；再比如考虑从算子到算子的映射，你仍然可以叫它算子。
>
> 算子这个词的来源以及意义，有什么作用，为什么可以这样用？ - <em>算子</em>的回答 - 知乎 https://www.zhihu.com/question/24989360/answer/29702293

增强是对图像进行加工，使其结果对**某些特定应用**而言比原图像的一种处理。

特定应用是指：增强技术是面向问题的，毕竟信息不会凭空增加。

# 基本的灰度变换函数

* 线性函数（反转和恒等变换）
* 对数函数（对数和反对数变换）
* 幂律函数（ n 次幂和 n 次根变换）

## 指对数变换

图源冈萨雷斯-数字图像处理-第四版：

![](C:/Users/Five/Desktop/note/img/2021012617324830.png)

对数变换的通式为
$$
s = c\log(1+r)
$$
这个变换将范围较窄的低灰度值映射为范围较宽的灰度级，如上图中 $[0, L/4]$ 中的输入灰度级映射到输出的 $[0,3L/4]$ 灰度级。这类变换扩展图像中的暗像素值，同时压缩高灰度级值。

指数变换功能和此正好相反。

对于如下图所示的傅里叶频谱，对数变换使得图像的细节层次能够清晰可见，而不是被少量高亮的像素支配。

![](C:\Users\Five\Desktop\note\img\image-20221107163114552.png)

## 幂律（伽马）变换

$$
s = c r^{\gamma}
$$

![](C:/Users/Five/Desktop/note/img/20210127175010707.png)

如阴极射线管具有灰度-电压响应，他是一个幂函数。

可以使用幂律灰度变换增强图像的对比度

## 分段线性变换

分段线性函数的形式可以任意复杂。

### 对比度拉伸

![](C:/Users/Five/Desktop/note/img/20210128145023815.png)

上图所示的分段线性变换可以用于对大量像素在较短灰度区间的图片进行对比度拉伸。

### 灰度级分层

![](C:/Users/Five/Desktop/note/img/20210128150438576.png)

上述分段线性变换分别对应为图像的二值化和对特定区域的高亮。

### 比特平面分层

![](C:\Users\Five\Desktop\note\img\image-20221108095249896.png)

下图中分别是原图和 bit plane 8 到 bit plane 1 的单比特图像，可见 bit plane 8 具有最多的信息，低层的 plane 几乎像噪声。

![image-20221108095336992](C:\Users\Five\Desktop\note\img\image-20221108095336992.png)

# 直方图处理

$$
h(r_k) = n_k, \quad k=0,1,2,\dots,L-1
$$



![](C:\Users\Five\Desktop\note\img\image-20221108101145523.png)

## 直方图均衡化

对于变换
$$
s = T(r) , \quad 0 \leqslant r \leqslant L-1
$$
首先至少需满足

* （严格）单调递增
  * 严格单调保证了映射是一对一的，对后续直方图处理技术的推导有意义。
* 值域 = 定义域 = $[0,L-1]$



（$p_r(r), p_s(s)$ 分别表示两幅图像中灰度值分布的概率密度函数 PDF）

若已知 $p_r(r)$ 和 $s =T (r)$，则可根据概率论有一个基本的结论：
$$
p_s(s) = p_r(r) |\frac {\mathrm d r}{\mathrm d s}| 
$$
即 s 是关于 r 的一个变限积分：
$$
s = T(r) = (L-1) \int_0 ^r p_r(t)\mathrm dt
$$
显然，上式是满足之前提到的两个条件的。有了上式之后，带回去可以较为简单地校验 s 的概率分布为理想的、在 $[0,L-1]$ 上的 $\frac 1 {L-1} $.

即对任意的 $p_r(r)$ ，应用该变换，都可以得到一个均匀的 PDF 表征。

对于离散值，用概率与求和来代替概率密度函数和积分。
$$
s_k = T(r_k) = (L-1) \sum _{j=0} ^{k} p_r(r_j), \quad k=1,2,\dots,L-1
$$

## 直方图匹配





## 局部直方图处理





## 使用直方图统计量增强图像



# 空间滤波基础

一般来说，大小为 $m \times n$ 的核对大小为 $M\times N$ 的图像的线性空间滤波可以表示为：
$$
g(x,y) = \sum _{s = -a} ^a \sum _{t=-b}^b w(s,t)f(x+s,y+t)
$$

## 空间相关和卷积

相关的运算过程如下（其中 `//` 表示除法并取整数部分，至少 python 里习惯这么写）：
$$
g(x) = \sum _{s = -L//2} ^{L//2} w(s) f(x+s) \\
g(x) = \sum _{s = -a} ^a \sum_{s=-b} ^b w(s,t) f(x-s, y-t)
$$
卷积的原理相同，只是把相关运算的核旋转了180°；若核的值关于核的中心对称，则相关和卷积的结果相同。



核 $w$ 与离散单位冲激函数 $f$ （只有一个元素为1，其余均为0）的空间相关结果为一个 $w$ 的副本，但副本旋转了 180°。

核 $w$ 与离散单位冲激函数 $f$ 卷积的结果为 $w$.



**卷积满足交换律和结合律（$f\star g = g\star f, f\star(g\star h) = (f\star g) \star h$），相关不满足**

满足交换律意味着多次滤波（卷积）可以通过单次滤波完成：$w = w_1 \star w_2 \star \cdots \star w_n$

### 冲激和线性系统理论

略，且大概率没水平填坑。

## 可分离滤波器核





## 空间域滤波 vs 频率域滤波



# 平滑（低通）空间滤波器



## 盒式滤波器核



## 均值滤波函数

即平权的卷积，略



## 高斯滤波函数

使用高斯分布作为滤波函数
$$
f(x) = \frac {1}{\sqrt {2\pi}\sigma} e^{-\frac {(x-v)^2}{2\sigma^2}}
$$






# 锐化（高通）空间滤波器

图像模糊在空间域中可以通过平均（平滑）一个邻域中的像素来实现，而由于平均运算类似于积分运算，因此可以合理地认为锐化能够通过空间微分来实现。事实上——也确实 work。

## 离散（数字）函数的导数

数字函数的导数是用差分来定义的。

* 恒定灰度区域的一阶导数必须为零
* 灰度台阶或斜坡开始处的一阶导数必须非零
* 灰度斜坡上的一阶导数必须非零

对于二阶导也需有类似的性质。

一维函数 $f(x)$ 的一阶导数的一个基本定义是如下差分：
$$
\frac {\partial f} {\partial x} = f(x+1) -f(x)
$$
将 $f(x)$ 的二阶导数定义（也可按导数定义从一阶导数定义的差分推导）为如下差分：
$$
\frac {\partial ^2 f}{\partial x^2} = f(x+1) + f(x-1) - 2f(x)
$$

## 二阶导数和 Laplacian 算子

（据说 opencv 里的代码内部调用了 sobel 算子）



## 钝化掩蔽和高提升滤波

USM，Unsharpen Mask，钝化掩蔽，是20世纪30年代以来印刷和出版业一直用来锐化图像的过程。
$$
g_{\mathrm{mask}} (x,y) = f(x,y) - \bar f(x,y) \\
g(x,y) = f(x,y) + kg _{\mathrm {mask}}(x,y)
$$
对原图像先做一个高斯模糊（得到一个图像 $\bar f$），然后用原来的图像减去高斯模糊之后的图像（得到蒙版 $g_{\mathrm {mask}}$），再将蒙版（可以调整系数由控制锐化程度）与原图像相加，得到锐化后的图像。

$k>1$ 时，这个过程称为高提升滤波。

k 值过大，或图像中有 0 值，可能会使最终结果中存在负灰度值。负值会使得边缘出现暗晕。k 值太大时，会令人不快。

![image-20221109105331469](C:\Users\Five\Desktop\note\img\image-20221109105331469.png)

## 一阶导数锐化图像

$$
\nabla f 
\equiv \mathrm{grad}(f) 
= \begin{bmatrix} g_x \\ g_y \end{bmatrix} 
= 
\begin{bmatrix} 
\frac {\partial f }{\partial x} \\
\frac {\partial f }{\partial y}
\end{bmatrix} \\
M(x,y) = || f|| =\mathrm {mag} (\nabla f) = \sqrt{g_x^2 + g_y ^2} 
$$

 部分情况下会用绝对值来近似平方运算和平方根运算
$$
M(x,y) \approx |g_x| + |g_y|
$$




### Robert 算子

1965年，Roberts 在数字图像处理早期的开发中，使用交叉差值提出了其他两个定义



### Sobel 算子

一般来说，总是更喜欢奇数大小的核，其关于唯一的中心空间对称。此时，其 $g_x$ 和 $g_y$ 可近似如下：
$$
g_x = \frac {\partial f} {\partial x} =(z_7 + 2z_8 +z_9) - (z_1 + 2z_2 + z_3) \\
g_y = \frac {\partial f} {\partial y} =(z_3 + 2z_6 + z_9) - (z_1 + 2z_4 + z_7)
$$
![image-20221109131015541](C:\Users\Five\Desktop\note\img\image-20221109131015541.png)

在中心系数中使用权值2的原因是，强调中心的重要程度来实现某种平滑。

### 其他

* Prewitt 算子
* Kirsch 算子

 

# 低通、高通、带阻和带通滤波器

