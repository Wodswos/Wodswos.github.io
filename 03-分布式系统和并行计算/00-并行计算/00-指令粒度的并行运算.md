

# X86 SSE/AVX指令集

SSE（Stream SIMD Extensions）/AVX（Advanced Vector Extensions）是x86体系的SIMD（Single Instruction Mutiple Data）扩展指令集

SIMD，单指令多数据流，能够复制多个操作数，并把他们打包在大型寄存器的一组指令集。



![](C:/Users/Five/Desktop/note/img/635010afa088183ec34140181e876ef1_1440w.png)

```c++
vectorAdd(const float* a, const float* b, const float* c){
    for(int i=0; i<8; i++) {
        c[i] = a[i] + b[i];
    }
}
```

```c++
__m256 vectorAdd(__m256 a, __m256 b, __m256 c) {
    return _mm256_add_ps(a,b);
}
```



一方面，可以理解为SSE/AVX提供了一批正儿八经的新数据类型（直接从硬件层面支持的数据类型）：

| 数据类型 | 描述                                                 |
| -------- | ---------------------------------------------------- |
| _m128    | 128bit能容纳4个FLOAT变量（每个FLOAT 4字节/32比特）   |
| _m128d   | 128bit能容纳2个DOUBLE变量（每个DOUBLE 4字节/32比特） |
| _m128i   | 128bit能容纳4个INT变量（每个INT t4字节/32比特）      |
| _m256    | 256bit能容纳8个FLOAT变量                             |
| _m256d   | 256bit能容纳4个DOUBLE变量                            |
| _m256i   | 256bit能容纳8个INT变量                               |



有了数据类型，当然需要进一步有对数据类型的操作。Intel ICC和GCC支持的SSE/AVX指令的C接口声明在`intrinsic.h`头文件中。

SSE/AVX指令接口一般分为三部分：`_mm`或`_mm256`、操作函数名称、操作对象名及数据类型。即`_mm<bit_width>_<operation>_<data_type>`



`_mm`表示SSE指令，向量长度为64位或128位；`_m256`表示AVX指令，操作向量长度256位。



在`_mm`/`_mm256`后跟操作类型，如`__m128_add`，常用的有add、load、mul等。

> 一些函数操作会增加修饰符，如loadu表示不对其到向量长度的存储器访问。



指令第三部分为数据类型

* `_ps`表示向量中为单精度（SINGLE/FLOAT）数据，按32bit为一个单位
* `_pd`表示为双精度，64bit一个单位
* `_epi8`/`epi16`/`epi32`/`epi64`：INT类型数据，一个INT占8/16/32/64位
  * e猜测是externel的意思，表示128位向量寄存器，每e表示64位向量寄存器
  * 就像IA-16到IA-32通用寄存器的扩展也是加个E一样
* `epu8`/`epu16`/`epu32`/`epu64`：UNSIGNED，无符号整型
* `_ss`表示只操作向量中第一个SINGLE（单精度）类型。
* `si128`表示只操作第一个128位INT。





* 内存地址需要对齐到向量长度，否则会增加访问存储器的次数
  * SSE4指令要求存储器地址必须16字节对齐
  * AVX支持不对齐的读写，但性能大约会下降20%



## SSE内置函数



## AVX内置函数



## 优化实例



# GPU

[[09-其他补充-GPU基础常识]]



[^1]:AVX / AVX2 指令编程 - 安嘟嘟的文章 - 知乎 https://zhuanlan.zhihu.com/p/94649418
[^2]:《并行编程方法与实践》